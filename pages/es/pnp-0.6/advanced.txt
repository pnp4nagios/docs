===== Sistemas Distribuidos =====
Si Nagios se implementa como un sistema distribuido, tiene que decidir dónde se debería instalar PNP.

Desde un punto de vista técnico, esta cuestión no es relevante. PNP se puede instalar tanto en el servidor maestro como en el/los esclavo(s). ¿O sólo en el maestro?

Si PNP se ejecuta en el maestro, debe asegurarse de que los datos pasados a través de send_nsca desde el/los servidor(es) esclavo(s) contienen datos de rendimiento. A menudo otro check command se usa en el maestro.

Para ayudar a PNP a reconocer en el maestro, qué check command se ha usado en el esclavo para recolectar la información, process_perfdata.pl responde a un campo adicional al final de los datos de rendimiento.

<code>OK - 127.0.0.1: rta 2.687ms, lost 0% | rta=2.687ms;3000.000;5000.000;0; pl=0%;80;100;; [check_icmp]</code>    

Si PNP encuentra una cadena entre corchetes al final de los datos de rendimiento, este valor se usa como check command y como valor para la plantilla PNP.

La documentación de Nagios relativa a este tema se puede encontrar [[http://nagios.sourceforge.net/docs/3_0/distributed.html|aquí]]. El comando usado en la documentación es fácilmente adaptable.

<code>
define command{
	command_name	submit_check_result
	command_line	/usr/local/nagios/libexec/eventhandlers/submit_check_result $HOSTNAME$ '$SERVICEDESC$' $SERVICESTATE$ '$SERVICEOUTPUT$'
	}
</code>

debería cambiarse a

<code>
define command{
	command_name	submit_check_result
	command_line	/usr/local/nagios/libexec/eventhandlers/submit_check_result $HOSTNAME$ '$SERVICEDESC$' $SERVICESTATE$ '$SERVICEOUTPUT$ | $SERVICEPERFDATA$ [$SERVICECHECKCOMMAND$]'
	}
</code>

===== check_multi plugin=====

El plugin [[http://my-plugin.de/wiki/projects/check_multi/start|check_multi]] es uno de los primeros plugins que usa las nuevas características de Nagios 3.x. Check_multi puede ejecutar múltiples plugins de Nagios, pero sólo devuelve los resultados como un único servicio. La salida de check_multi se compone de varias líneas para mostrar toda la información.

Esto pone en aprietos a PNP que tiene que extraer la información de datos de rendimiento de varios plugins. En colaboración con Matthias Flacke, desarrollador de check_multi, se ha encontrado una solución para asignar los datos a los plugins apropiados.

{{http://my-plugin.de/wiki/_media/check_multi/performance/multi_labels.png?300}}

[[start|volver a contenido]] | [[rrdcached|soporte de rrdcached]]