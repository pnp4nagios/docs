====== Installation ======

Im Folgenden wird die Installation von PNP beschrieben. Dabei wird davon ausgegangen, dass Nagios aus den Sourcen übersetzt und im Verzeichnis /usr/local/nagios installiert wurde.\\ 
**Achtung:** Die Beschreibung bezieht sich auf PNP 0.4.14. Hinweise auf die jeweils aktuelle Version gibt es [[http://www.pnp4nagios.org/pnp/de/about#download|hier]].\\ 
Bitte vergessen Sie nicht, dass PNP nach der Installation noch konfiguriert werden muss.



===== Make und Co =====

Die Installation von PNP wird wie bei Nagios auch über [[wpde>Makefile]]s gesteuert. Dabei wird durch den Aufruf von ./configure das System analysiert und die ermittelten Werte in Makefiles übernommen.

Als User root wird PNP in /usr/local/src entpackt.
<code>
cd /usr/local/src
wget http://downloads.sourceforge.net/pnp4nagios/pnp-0.4.14.tar.gz
tar -xvzf pnp-0.4.13.tar.gz
cd pnp-0.4.13
</code>

Im Verzeichnis pnp-<version>, in unserem Fall pnp-0.4.14, wird nun ./configure aufgerufen.

<code>
./configure
</code>

Es laufen einige Zeilen über den Bildschirm. Wichtig ist die Ausgabe zum Schluss.

<code>
*** Configuration summary for pnp 0.4.14 ***

  General Options:
  -------------------------         -------------------
  Nagios user/group:                nagios nagios
  Install directory:                /usr/local/nagios
  HTML Dir:                         /usr/local/nagios/share/pnp
  Config Dir:                       /usr/local/nagios/etc/pnp
  Path to rrdtool:                  /usr/bin/rrdtool (Version 1.2.15)
  RRDs Perl Modules:                FOUND (Version 1.2015)
  RRD Files stored in:              /usr/local/nagios/share/perfdata
  process_perfdata.pl Logfile:      /usr/local/nagios/var/perfdata.log
  Perfdata files (NPCD) stored in:  /usr/local/nagios/var/spool/perfdata/
</code>

Die angezeigten Pfade sollten nun geprüft werden. Sollten die gezeigten Werte nicht passen, kann durch einen erneuten Aufruf von ./configure mit den passenden Optionen Abhilfe geschaffen werden.\\ 
**ACHTUNG:** Nachdem es immer wieder Schwierigkeiten gibt: "Path to rrdtool" bedeutet inkl. Namen des Binary! Bei Bedarf kann man das beim ./configure als Parameter angeben:

   ./configure --with-rrdtool=/usr/local/rrdtool-1.2.xx/bin/rrdtool

   ./configure --help 

zeigt, welche Optionen möglich sind.\\ \\ 
**Achtung:** Falls Nagios nicht unter /usr/local/nagios installiert ist und insbesondere bei der Verwendung von vorkonfigurierten Nagios-Packages reicht der Aufruf von ''/configure ----prefix=<Nagios-Home>'' im Allgemeinen NICHT aus, um PNP korrekt zu installieren. Wichtig sind in diesem Fall die Optionen am Ende der configure-Hilfeseite!\\ \\ 
Beispiel für Icinga:
<code>USER=icinga
GROUP=icinga
PREFIX=/usr/local/icinga
./configure \
	--with-nagios-user=$USER \
	--with-nagios-group=$GROUP \
	--prefix=$PREFIX \
	--datarootdir=$PREFIX/share/pnp \
	--with-rrdtool=/usr/bin/rrdtool \
	--sysconfdir=$PREFIX/etc/pnp \
	--with-perfdata-dir=$PREFIX/share/perfdata \
	--with-perfdata-logfile=$PREFIX/var/perfdata.log \
	--with-perfdata-spool-dir=$PREFIX/var/spool/perfdata</code>
\\ 
Ein

   make all

kompiliert nun die in C geschriebenen Komponenten wie NPCD

   make install

kopiert alles an die richtige Stelle im Filesystem. Die Pfade wurden ja beim ./configure bereits gezeigt.

Optional kann noch

   make install-config

aufgerufen werden. Damit werden Config-Files für process_perfdata.pl und npcd nach etc/pnp kopiert. 

Wir das INIT Script für den NPCD benötigt so sorgt

   make install-init

für die Installation nach /etc/init.d 

Zusammenfassen lassen sich diese einzelnen Commands durch
 
   make fullinstall



===== Update =====

Das Update funktioniert genauso wie die Installation. Bitte beachten Sie, dass Sie beim "./configure" die gleichen Optionen wie bei der Erstinstallation benutzen!
Bitte prüfen Sie außerdem, ob Sie Änderungen im Verzeichnis ''share/pnp/templates.dist'' vorgenommen haben. Eigene Templates sollten im Ordner ''share/pnp/templates'' abgelegt werden.\\ 
**Achtung**:  Wenn Sie in der Datei config.php Änderungen vorgenommen haben, sollten Sie diese Datei sichern, bevor sie bei einem "make install-config" überschrieben wird.

===== Debian Packages =====

PNP ist noch nicht offiziell als Debian Paket erhältlich. [[http://www.velt.de|Sven Velt]] arbeitet jedoch daran, daß sich dies ändert. 

Debian Pakete findet ihr auf http://www.velt.de/tags/nagios-pnp






===== Die Komponenten =====

Nach der Installation sind einige Komponenten von PNP an die passenden Stellen im Dateisystem kopiert worden.

Im Folgenden sind dies die PHP-Files für das Web-Frontend in 

   /usr/local/nagios/share/pnp

Der Datensammler process_perfdata.pl in 

   /usr/local/nagios/libexec

Beispiel-Config-Files mit der Dateierweiterung ''-sample'' in

   /usr/local/nagios/etc/pnp

Die Config-Datei config.php für das Web-Frontend in 

   /usr/local/nagios/etc/pnp

<[[start|Zurück zur Übersicht]]> <[[config|Konfiguration]]>