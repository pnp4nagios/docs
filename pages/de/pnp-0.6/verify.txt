====== Prüfen der Installation ======

Wenn bis jetzt alles sauber funktioniert hat, kann PNP zum ersten Mal im Browser aufgerufen werden.
Bei der Installation mit den Standardeinstellungen erfolgt der Aufruf über [[http://<Servername>/pnp4nagios/]].

Beim ersten Aufruf sieht man die Seite "PNP4Nagios Environment Tests", die verschiedene Tests von notwendigen Komponenten enthält. Offenkundig sollten alle Tests erfolgreich verlaufen, bevor es weitergehen kann. Bitte beachten Sie die Hinweise auf der Seite.\\ 

Sind alle Tests erfolgreich verlaufen, so kann die Datei ''pnp4nagios/share/install.php'' gelöscht oder umbenannt werden. Erst dann ist das Webinterface erreichbar.

Alternativ kann eine Datei ''pnp4nagios/share/install.ignore'' angelegt werden, um den Aufruf des Installers nach weiteren Updates zu ignorieren. 

Ohne weitere Optionen sucht PNP nach RRD- und XML-Dateien in ''pnp4nagios/var/perfdata/'' und zeigt alle Graphen des ersten Hosts in der Übersicht an.

ACHTUNG: Direkt nach dem (Neu-)Start von Nagios nach dem Aktivieren der Verarbeitung von Performance-Daten wird der Aufruf im Browser zu Fehlermeldungen führen, weil zunächst Performance-Daten gesammelt und in den RRD-Dateien abgelegt werden müssen. Abhängig vom Check-Intervall kann es einige Zeit dauern, bis die ersten Graphen angezeigt werden können.

===== Logfile =====

Während der Installation wurde durch den Aufruf von ''make install-config'' ein Beispiel-Config-File ''etc/process_perfdata.cfg-sample'' erzeugt. Die Werte in der sample-Datei entsprechen den Default-Werten, die auch in ''process_perfdata.pl'' fest hinterlegt sind, daher ist die ''process_perfdata.cfg'' für den Betrieb nicht zwingend notwendig.

Die Datei ''process_perfdata.cfg-sample'' kann somit als Vorlage für die ''process_perfdata.cfg'' dienen, die immer dann notwendig ist, wenn vom Standard abweichende Werte eingestellt werden sollen.

In der ''process_perfdata.**cfg**'' lässt sich das Verhalten von ''process_perfdata.pl'' vielfach beeinflussen.

Die wichtigsten Optionen für die Inbetriebnahme sind LOG_LEVEL und LOG_FILE. Im laufenden Betrieb sollte der Log-Level immer auf 0 gesetzt sein, um die Performance von process_perfdata.pl nicht durch unnötiges Schreiben von Logfiles zu beeinträchtigen.

Während der Inbetriebnahme sollte man jedoch den ''LOG_LEVEL'' auf "2" setzen, um zu sehen, was process_perfdata.pl bei der Verarbeitung der Performance-Daten so alles anstellt.

Spätestens bei [[about#support|Support Anfragen]] im Forum oder auf den Mailinglisten werden wir sowohl nach Auszügen aus dem perfdata.log als auch nach der Ausgabe des [[verify_pnp_config|verify_pnp_config-Scripts]] fragen. Es empfiehlt sich also, diese Angaben gleich mitzuliefern ;-).

===== Was aber wenn nicht ? =====

Einige grundlegende Einstellungen sind zu prüfen.

1. Sind RRD- und XML-Files erzeugt worden ?

''process_perfdata.pl'' legt für jeden Host unter var/perfdata ein neues Verzeichnis an. In diesem Verzeichnis wird wiederum für jeden Service eine RRD-Datenbank und ein XML-File erstellt. Für den Host-Check lautet der Dateinamen ''_HOST_.xml'' bzw. ''_HOST_.rrd''.\\ 
Falls Graphen urplötzlich nicht mehr weitergeführt werden, dann hilft vielleicht ein Blick in die betroffene XML-Datei. Dort gibt es u.a. die Tags <RC> und <TXT>. <RC> zeigt den Return-Code des RRDtool-Updates der RRD-Datei, <TXT> eine textuelle Beschreibung.\\ 
Allerdings liefern nicht alle Checks Performance-Daten, das gilt u.a. für "check_ping", die Alternative "check_icmp" dagegen erzeugt Daten (ab Nagios-Plugin-Version 1.4.12 liefert auch check_ping Performance-Daten).\\ 
Teilweise muss man zusätzliche Optionen aktivieren, damit Performance-Daten ausgegeben werden. Evtl. kann das auch durch ein [[wrapper|Wrapper-Script]] geändert werden.\\ 
In den Detailinformationen zu jedem Host/Service gibt es das Feld "Performance-Data". Wenn dort keine Daten stehen, dann werden im jeweiligen Verzeichnis keine Dateien erzeugt und PNP kann deshalb auch keine grafischen Auswertungen liefern!\\ 
Das folgende Bild zeigt die Informationen zu einem "PING"-Service. Das blaue Feld enthält den vom Plugin gelieferten Text, das rote die Performance-Daten, die Nagios erkannt hat.\\ 
{{:srv_info.png?250|Informationen zu "PING"}}

2. Hat Nagios ''process_perfdata.pl'' aufgerufen ?

In der Config-Datei für process_perfdata.pl, der ''etc/process_perfdata.**cfg**'' lässt sich der Debug-Level erhöhen. Die Verarbeitung der Daten wird nun in ''var/perfdata.log'' bzw. im Syslog protokolliert.

3. Grafiken werden ohne Text angezeigt ?

siehe [[about#anforderungen|Anforderungen]]

4. Einige Graphen werden angezeigt, andere melden den Fehler ''"parser error: Input is not proper UTF-8"'' oder etwas ähnliches. Bitte prüfen Sie, ob die Daten "spezielle" Zeichen enthalten, die nicht im ASCII-Zeichensatz vorhanden sind (Umlaute, etc). Versuchen Sie, in ''process_perfdata.cfg'' den Wert von ''XML_ENC'' auf ''ISO-8859-1'' oder einen anderen passenden Wert zu setzen. Warten Sie, bis die xml-Datei neu erzeugt wurde und probieren Sie es nochmal.

5. Bei aktiviertem npcdmod-Modul muss der Wert von ''event_broker_options'' in der nagios.cfg ggf. angepasst werden. Hinweise gibt es [[config#bulk_mode_with_npcd_und_npcdmod|hier]].

6. verify_pnp_config
Das Perl-Script [[verify_pnp_config|verify_pnp_config.pl]] ermöglicht die Prüfung von Konfigurationseinstellungen und zeigt, ob Performance-Daten vorhanden sind.

7. Es scheint zu funktionieren, aber es bleiben einige Dateien Spool-Verzeichnis stehen (/usr/local/pnp4nagios/var/spool/<perfdata_filename>-PID-<process_perfdata_pid>). Wenn ''process_perdata.pl'' nicht in das Zielverzeichnis (/usr/local/pnp4nagios/share/perfdata/<host>) schreiben kann, wird es anhalten und die Quelldatei nicht löschen. Das erhöht die Größe des Spool-Verzeichnisses und die Verarbeitung der Performance-Daten verlangsamen. Dieses Problem kann auftreten, wenn Sie Verzeichnisse aus einer vorherigen Installation kopiert und/oder manuell Verzeichnisse angelegt haben und dabei die falschen Benutzer/Berechtigungen verwendet haben.

[[start|zurück zur Übersicht]] | [[verify_pnp_config|verify_pnp_config.pl]]