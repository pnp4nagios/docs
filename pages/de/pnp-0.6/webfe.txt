====== Das Nagios Web Frontend ======

PNP soll natürlich schnell erreichbar sein. Man möchte nicht lange nach den richtigen Graphen suchen.

Nagios selbst bietet die Möglichkeit, externe URLs über die sogenannte Extended Info Config einzubinden.
Da es in diesem Bereich eine Änderung zwischen Nagios 2.x und der Version 3.0 gibt, wird anschließend auf beide Versionen getrennt eingegangen.

===== Nagios 2.x =====

Bis Nagios 2.x erfolgt die Einbindung externer URLs in das Nagios-Web-Interface über die [[http://www.nagios-wiki.de/nagios/doku3/objectdefinitions#serviceextinfo|Extended-Info-Objekte]]. Für PNP verwenden wir die Option action_url, um das PNP-Web-Frontend mit den passenden Optionen aufzurufen.

<code>
define serviceextinfo {
   name                  srv-pnp
   action_url            /pnp4nagios/index.php/graph?host=$HOSTNAME$&srv=$SERVICEDESC$
   register              0
}
</code>

Dieses Template kann nun über "use srv-pnp" in der serviceextinfo-Definition verwendet werden. Wenn Sie die Schnellstart-Installationsanleitungen benutzt haben, können Sie beispielsweise in der Datei localhost.cfg die Definitionen wie folgt erweitern:

<code>
define serviceextinfo {
   use                     srv-pnp   ; Name of service templates to use
   host_name               localhost
   service_description     load
}
</code>

===== Nagios 3.x =====

Seit Nagios 3.0 ist die Direktive action_url in die [[http://www.nagios-wiki.de/nagios/doku3/objectdefinitions#host|Host]]- bzw. [[http://www.nagios-wiki.de/nagios/doku3/objectdefinitions#service|Service]]-Definition verschoben worden. Die [[http://www.nagios-wiki.de/nagios/doku3/objectdefinitions#serviceextinfo|serviceextinfo]]- und [[http://www.nagios-wiki.de/nagios/doku3/objectdefinitions#hostextinfo|hostextinfo]]-Definitionen sind entfallen. Damit wird die Definition der URLs zum PNP-Interface wesentlich vereinfacht.

Zuerst definieren wir zwei Nagios-Templates. Falls Sie die [[http://www.nagios-wiki.de/nagios/doku3/quickstart|Schnellstart-Installationsanleitungen]] für Nagios benutzt haben, können Sie die folgenden Zeilen der Datei templates.cfg hinzufügen:

<code>
define host {
   name       host-pnp
   action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&srv=_HOST_
   register   0
}

define service {
   name       srv-pnp
   action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&srv=$SERVICEDESC$
   register   0
}
</code>

Diese beiden Templates können nun über "use srv-pnp" in der Service-Definition oder "use host-pnp" in der Host-Definition verwendet werden. Wenn Sie die Schnellstart-Installationsanleitungen benutzt haben, können Sie beispielsweise in der Datei localhost.cfg die Definitionen wie folgt erweitern:
<code>define host{
        use                     linux-server,host-pnp    ; Name of host templates to use
                                                         ; This host definition will inherit all variables that are defined
                                                         ; in (or inherited by) the linux-server host template definition.
        host_name               localhost
        alias                   localhost
        address                 127.0.0.1
        }
</code>

<code>define service{
        use                     local-service,srv-pnp   ; Name of service templates to use
        host_name               localhost
        service_description     PING
        check_command           check_ping!100.0,20%!500.0,60%
        }
</code>
Die Links auf die richtigen URLs werden automagisch erstellt.

===== Preview Popup =====

Außerdem gibt es die Möglichkeit, die Graphen bereits in der Statusübersicht beim Überfahren des "Action Url Icons" mit der Maus einzublenden.

Ermöglicht wird dies durch die [[http://nagios.sourceforge.net/docs/3_0/cgiincludes.html|CGI Includes]], die es uns erlauben, Javascript-Code an geeigneter Stelle im Seitenkopf der Statusübersicht einzubinden ( status.cgi ). 

In den PNP-Quellen ist die Datei ''contrib/ssi/status-header.ssi'' bereits enthalten, die verwendeten URLs müssen aber unter Umständen angepasst werden. Wir gehen hier davon aus, dass PNP über ''/pnpnagios/index.php'' erreichbar ist.

Die besagte Datei muss in das Verzeichnis ''/usr/local/nagios/share/ssi/'' kopiert werden und darf **NICHT** ausführbar sein. Nagios würde die Datei sonst wirklich wie ein CGI behandeln und ausführen, was aber in diesem Fall zu Fehlern führen würde. Die Apache-Admins mögen bitte "Nagios SSI" nicht mit "Apache SSI" in Verbindung bringen. Beides hat nichts miteinander zu tun. 

Die action_url ist entsprechend anzupassen: 

<code>
define host {
   name       host-pnp
   register   0
   action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&srv=_HOST_' class='tips' rel='/pnp4nagios/index.php/popup?host=$HOSTNAME$&srv=_HOST_
}

define service {
   name       srv-pnp
   register   0
   action_url /pnp4nagios/index.php/graph?host=$HOSTNAME$&srv=$SERVICEDESC$' class='tips' rel='/pnp4nagios/index.php/popup?host=$HOSTNAME$&srv=$SERVICEDESC$
}
</code>

Nach einem Restart von Nagios (nach Anpassung der Definitionen) sieht das Ergebnis ungefähr so aus:\\ 
{{:popup.png?200}} 

[[start|Zurück zur Übersicht]] | [[webfe_cfg|Konfiguration Web-Frontend]]