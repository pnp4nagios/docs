====== Vérification de votre installation ======

Si tout c'est bien passé jusqu’à présent vous pouvez essayer d’accéder à PNP en lançant votre navigateur web.
Quand vous installez PNP avec les valeurs par défaut vous devriez pouvoir y accéder en utilisant [[http://<server name>/pnp4nagios/]].
La première fois vous allez voir la page "PNP4Nagios Environment Tests" qui inclue différents tests pour vérifier que les composants nécessaires au bon fonctionnement sont bien installés. Evidemment, toutes les vérifications doivent être passées avec succès avant de pouvoir continuer.\\ 

Si tous les tests sont passés avec *succès* le fichier pnp4nagios/share/install.php peut être effacé ou renommé. Après cela l'interface web sera accessible.

Vous pouvez également créer un fichier vide, appelé ''pnp4nagios/share/install.ignore'' ce qui aura comme effet de ne pas appeler le vérificateur d'installation au prochain chargement.
 
Si vous recevez le message "PHP magic_quotes_gpc is deprecated" editez votre ''php.ini'' et assurez vous que "magic_quotes_gpc = Off", rechargez la configuration de apache pour que les changements prennent effet.

Lancé sans argument, PNP va chercher la base de données RRD et fichiers XML dans pnp4nagios/var/perfdata et afficher tous les graphiques du premier host.

ATTENTION: Après avoir activé l'analyse des données de performance, vous obtiendrez un message d'erreur dans votre navigateur, si vous essayez de visualiser les graphiques avant que nagios n'ait récupéré les premières données de performance et les ait stockées dans la base RRD du service monitoré. Selon l'intervalle de vérification configuré, vous devrez attendre un certain temps avant de pouvoir voir les différents graphiques.

===== Debug Logfile =====

L'appel de ''make install-config'' pendant l'installation, va créer le fichier d’exemple de configuration ''etc/process_perfdata.cfg-sample''. Les valeurs dans ce fichier correspondent aux valeurs par défaut utilisées par ''process_perfdata.pl'' donc normalement le fichier  ''process_perfdata.cfg'' n'existe pas si vous suivez la procédure d'installation normal.\\ 
Cependant vous pouvez influencer la façon dont ''process_perfdata.pl'' fonctionne en changeant les options que vous voulez modifier dans ''process_perfdata.**cfg**''. 

Les options les plus importantes quand on lance PNP sont ''LOG_LEVEL'' et ''LOG_FILE''. Nous recommandons de configurer la valeur de ''LOG_LEVEL'' à "2" pour que vous puissiez suivre ce que fait ''process_perfdata.pl''.
Il est très probable que nous demandions un extrait de ''perfdata.log'' si vous ouvrez un ticket avec notre [[about#support|support]] sur notre mailing lists ainsi le résultat du script [[verify_pnp_config]], donc merci de les inclure ;-).

En temps normal le niveau de debug doit être mis à ''0'' pour éviter tous problèmes de performance dus à une écriture de logs inutile.

===== Quelque chose ne va pas =====

Vérifiez quelques éléments de base.

1. Y a t'il des fichiers RRD et XML qui ont été créés?
''process_perfdata.pl'' va créer un répertoire sous pnp/perfdata pour chaque host. Dans ce répertoire une base de donnée RRD et un fichier XML vont être créés pour chaque service. Les données de l'host seront stockées dans ''_HOST_.xml'' et ''_HOST_.rrd'' respectivement.\\ 
Si l’affichage du graphique stoppe soudainement, alors éditez le fichier XML approprié. Il y a 2 balises appelées <RC> et <TXT>. <RC> montre le code renvoyé par l'outil RRDtool et <TXT> une description texte. \\
De temps en temps vous devez spécifier des options supplémentaires pour que les données de performance soient gérées correctement. Dans certain cas un [[wrapper|wrapper script]] peut aider.\\ 
Attention, tous les scripts de checks ne donnent pas forcément des indicateurs de performance. Ceci s'applique - mais pas seulement - à "check_ping" au contraire de "check_icmp" qui fournit ces données (Depuis la version version 1.4.12 de Nagios plugin, check_ping donne des informations de performance).\\ 
En utilisant l'interface web on peut voir le champ "Performance Data" dans chaque hosts/services. Si ce champ est vide, il n'y a pas de données disponibles, donc aucun fichier n'est écrit dans le dossier de PNP et c'est pour cela que PNP ne fournit pas de graphes!\\ 
L'image suivante montre les informations du service "PING". La sortie du plugin est encadrée en bleu, les données de performance en rouge.\\ 
{{:srv_info.png?350|status information}}

2. Est ce que Nagios a appelé le script ''process_perfdata.pl''?
Dans le fichier de configuration de process_perfdata.pl (''etc/process_perfdata.**cfg**'') vous pouvez augmenter le niveau de debug. Toutes les données passant par le système seront loggées dans ''var/perfdata.log''.

3. Seul les Graphiques sont affichés (sans les textes)?
Vérifiez que vous avez bien tous les [[about#system_requirements|prérequis]].

4. En utilisant le module npcdmod la valeur de la directive ''event_broker_options'' dans votre nagios.cfg devra peut être adapté si vous en avez modifié la configuration. Vous trouverez plus de détails [[config#bulk_mode_with_npcd_and_npcdmod|ici]].

5. Vous pouvez utiliser le script [[verify_pnp_config|verify_pnp_config.pl]] dans le dossier ''scripts'' du dossier d'installation ou dans le dossier ''libexec'' après installation pour vérifier votre configuration ainsi que s'assurer que les données de performance sont bien présentes et/ou valides. La syntaxe de cette commande est relativement simple:
<code>./verify_pnp_config.pl -m <mode></code> ou ''<mode>'' peut être égale à "sync", "bulk" ou "npcd" (sans les guillemets). NOTE: La valeur par "default" est "npcd" ce qui est différent de la version PNP 0.4.x.

[[start|Retour a l'index]] | [[verify_pnp_config|verify_pnp_config.pl]]